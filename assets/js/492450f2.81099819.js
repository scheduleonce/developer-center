"use strict";(self.webpackChunkdocos=self.webpackChunkdocos||[]).push([[211],{8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}},9959:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"webhooks/webhook-signatures","title":"Webhook Signatures","description":"Verify the events that OnceHub sends to your webhook endpoints.","source":"@site/docs/webhooks/webhook-signatures.md","sourceDirName":"webhooks","slug":"/webhooks/webhook-signatures/","permalink":"/developer-center/docs/webhooks/webhook-signatures/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/webhooks/webhook-signatures.md","tags":[],"version":"current","frontMatter":{"id":"webhook-signatures","title":"Webhook Signatures","description":"Verify the events that OnceHub sends to your webhook endpoints.","slug":"/webhooks/webhook-signatures/"},"sidebar":"docs","previous":{"title":"Managing Webhook Subscriptions","permalink":"/developer-center/docs/webhooks/managing-webhook-subscriptions/"},"next":{"title":"FAQs","permalink":"/developer-center/docs/developer-support/frequently-asked-questions/"}}');var i=n(4848),r=n(8453);const a={id:"webhook-signatures",title:"Webhook Signatures",description:"Verify the events that OnceHub sends to your webhook endpoints.",slug:"/webhooks/webhook-signatures/"},o=void 0,c={},d=[{value:"Verifying Signatures",id:"verifying-signatures",level:2},{value:"Step 1: Extract the Timestamp and Signatures from the Header",id:"step-1-extract-the-timestamp-and-signatures-from-the-header",level:4},{value:"Step 2: Prepare the <code>signed_payload</code> String",id:"step-2-prepare-the-signed_payload-string",level:4},{value:"Step 3: Determine the Expected Signature",id:"step-3-determine-the-expected-signature",level:4},{value:"Step 4: Compare the Signatures",id:"step-4-compare-the-signatures",level:4}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["OnceHub can sign all webhook events sent to your endpoints with a signature. This signature appears in each event's ",(0,i.jsx)(t.code,{children:"Oncehub-Signature"})," header. It allows you to verify that the events were sent by OnceHub rather than a third party."]}),"\n",(0,i.jsxs)(t.p,{children:["Before you can verify signatures, you need to retrieve your endpoint's secret from your OnceHub dashboard's webhooks settings in the ",(0,i.jsx)(t.a,{href:"https://app.oncehub.com/integrations/api",children:"Webhook & API integration section"}),". Find the relevant webhook and click ",(0,i.jsx)(t.em,{children:"View secret"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["OnceHub generates a unique secret key for each endpoint separately. If the webhook was created in v2 of the API, each event will be signed with the secret. If you don't see the ",(0,i.jsx)(t.em,{children:"View secret"})," option, this means you are using v1 of the API. Any new endpoints will be created using v2."]}),"\n",(0,i.jsx)(t.h2,{id:"verifying-signatures",children:"Verifying Signatures"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"Oncehub-Signature"})," header included in each signed webhook event contains a timestamp and a signature. The timestamp is prefixed by ",(0,i.jsx)(t.code,{children:"t="}),", and the signature is prefixed ",(0,i.jsx)(t.code,{children:"s="}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"t=1611144604,s=22b3f46eed16d8a41b492334b626dcf04aca47232102208e2d3424051402adcc\n"})}),"\n",(0,i.jsxs)(t.p,{children:["OnceHub generates signatures using a hash-based message authentication code (",(0,i.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Hash-based_message_authentication_code",children:"HMAC"}),") with ",(0,i.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/SHA-2",children:"SHA-256"}),"."]}),"\n",(0,i.jsx)(t.h4,{id:"step-1-extract-the-timestamp-and-signatures-from-the-header",children:"Step 1: Extract the Timestamp and Signatures from the Header"}),"\n",(0,i.jsxs)(t.p,{children:["Split the header, using the ",(0,i.jsx)(t.code,{children:","})," character as the separator, to get a list of elements. Next, split each element, using the ",(0,i.jsx)(t.code,{children:"="})," character as the separator, to get a prefix and value pair."]}),"\n",(0,i.jsxs)(t.p,{children:["The value for the prefix ",(0,i.jsx)(t.code,{children:"t"})," corresponds to the timestamp and ",(0,i.jsx)(t.code,{children:"s"})," corresponds to the signature"]}),"\n",(0,i.jsxs)(t.h4,{id:"step-2-prepare-the-signed_payload-string",children:["Step 2: Prepare the ",(0,i.jsx)(t.code,{children:"signed_payload"})," String"]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"signed_payload"})," string is created by concatenating:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The timestamp (as a string)"}),"\n",(0,i.jsxs)(t.li,{children:["The character ",(0,i.jsx)(t.code,{children:"."})]}),"\n",(0,i.jsx)(t.li,{children:"The actual JSON payload (i.e., the request body)"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"For example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'1611144604.{"id":"EVNT-2AB8RJY3LF","object":"event","creation_time":"2021-01-20T12:10:03.140Z","type":"booking.scheduled","api_version":"v2","data":{"object":"booking","id":"BKNG-YNMGHKQ24XV5","tracking_id":"BKNG-YNMGHKQ24XV5","subject":"15-minute meeting","status":"scheduled","in_trash":false,"creation_time":"2021-01-20T12:10:02.487Z","starting_time":"2021-01-20T16:45:00.000Z","last_updated_time":"2021-01-20T12:10:02.753Z","owner":{"id":"USR-YX0J4ANZTV","object":"user","first_name":"Michael","last_name":"","email":"michael@example.com","status":"active"},"duration_minutes":15,"virtual_conferencing":{"join_url":""},"location_description":"","rescheduled_booking_id":"","cancel_reschedule_information":{"reason":"","actioned_by":"","user_id":""},"form_submission":{"name":"Carrie","email":"carrie@customer.com","phone":"","mobile_phone":"","note":"","company":"","guests":[],"custom_fields":[]},"booking_page":{"id":"BP-L5SMQPFA1V","object":"booking_page","name":"Michael ","label":"Michael4","url":"https://go.oncehub.com/Michael4","active":true},"master_page":null,"event_type":{"id":"ET-E8DL20JT5U","object":"event_type","name":"15-minute meeting","description":""},"external_calendar":{"type":"none","name":"","id":"","event_id":""}}}\n'})}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"\ud83d\udea7"}),"\n",(0,i.jsx)(t.p,{children:"Don't apply any formatting on the request body payload; take it as it is. If you apply formatting, it will add white-space characters that will result in a wrong signature construction."}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"step-3-determine-the-expected-signature",children:"Step 3: Determine the Expected Signature"}),"\n",(0,i.jsxs)(t.p,{children:["Compute an HMAC with the SHA256 hash function. Use the endpoint\u2019s signing secret as the key, and use the ",(0,i.jsx)(t.code,{children:"signed_payload"})," string as the message."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",metastring:"Node.js",children:'const crypto = require("crypto");\n\nconst toBeSignedPayload = time + "." + body;\nconst expected = crypto\n  .createHmac("sha256", secret)\n  .update(toBeSignedPayload)\n  .digest("hex");\n'})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'using System;\nusing System.Security.Cryptography;\nusing System.Text;\n\nclass MainClass {\n  public static void Main (string[] args) {\n    string toBeSignedPayload = timestamp + "." + body;\n\n    Encoding encoding = new UTF8Encoding();\n    byte[] secretBytes = encoding.GetBytes(secret);\n    byte[] messageBytes = encoding.GetBytes(toBeSignedPayload);\n    HMACSHA256 cryptographer = new HMACSHA256(secretBytes);\n\n    byte[] expectedBytes = cryptographer.ComputeHash(messageBytes);\n\n    string expected = BitConverter.ToString(expectedBytes).Replace("-", "").ToLower();\n\n    Console.WriteLine(expected);\n\n  }\n}\n'})}),"\n",(0,i.jsx)(t.h4,{id:"step-4-compare-the-signatures",children:"Step 4: Compare the Signatures"}),"\n",(0,i.jsx)(t.p,{children:"Compare the signature in the header to the expected signature. For an equality match, compute the difference between the current timestamp and the received timestamp, then decide if the difference is within your tolerance."})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);